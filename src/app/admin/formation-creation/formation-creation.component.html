<div #topContainer class="formation-creation-container">
  <!-- Header avec titre et messages -->
  <div class="header-section">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-lg-10">
          <h1 class="page-title">
            <i [ngClass]="isEditMode ? 'bi bi-pencil-square' : 'bi bi-plus-circle-fill'"></i>
            {{ isEditMode ? 'Modifier une formation' : 'Créer une nouvelle formation' }}
          </h1>
          <!-- Messages de statut -->
          <div class="status-messages">
            @if (successMessage) {
              <div class="alert alert-success alert-modern" role="alert">
                <i class="bi bi-check-circle-fill"></i>
                {{ successMessage }}
              </div>
            }
            @if (errorMessage) {
              <div class="alert alert-danger alert-modern" role="alert">
                <i class="bi bi-exclamation-triangle-fill"></i>
                {{ errorMessage }}
              </div>
            }
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Contenu principal -->
  <div class="main-content">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-lg-12 col-xl-10">
          <div class="creation-card">
            <div class="row g-0">

              <!-- Section Images (gauche) -->
              <div class="col-lg-4">
                <div class="image-section">
                  <div class="section-header">
                    <h3 class="section-title">
                      <i class="bi bi-images"></i>
                      Visuels
                    </h3>
                  </div>

                  <!-- Image principale -->
                  <div class="image-upload-container">
                    <label class="upload-label">
                      <span class="upload-title">Photo principale *</span>
                      <div class="upload-zone" [class.has-image]="imagePreview">
                        <input type="file"
                               id="photoPrincipale"
                               (change)="onFileSelected($event)"
                               accept="image/*"
                               class="file-input">
                        @if (!imagePreview && !isImageUploading) {
                          <div class="upload-placeholder">
                            <i class="bi bi-cloud-upload"></i>
                            <span>Cliquez pour choisir une image</span>
                            <small>PNG, JPG jusqu'à 5MB</small>
                          </div>
                        }
                        @if (isImageUploading) {
                          <div class="upload-loading">
                            <div class="spinner"></div>
                            <span>Upload en cours...</span>
                          </div>
                        }
                        @if (imagePreview) {
                          <div class="image-preview">
                            <img [src]="imagePreview" alt="Aperçu formation">
                            <div class="image-overlay">
                              <i class="bi bi-pencil"></i>
                              <span>Changer l'image</span>
                            </div>
                          </div>
                        }
                      </div>
                    </label>
                  </div>

                  <!-- Galerie d'images -->
                  <div class="gallery-upload-container">
                    <label class="upload-label">
                      <span class="upload-title">Galerie d'images</span>
                      <div class="upload-zone gallery-zone">
                        <input type="file"
                               id="galleryImages"
                               (change)="onGalleryFilesSelected($event)"
                               accept="image/*"
                               class="file-input"
                               multiple>
                        <div class="upload-placeholder small">
                          <i class="bi bi-collection"></i>
                          <span>Ajouter des images</span>
                          <small>Max 10 images</small>
                        </div>
                      </div>
                    </label>
                    @if (galleryImagePreviews.length > 0) {
                      <div class="gallery-preview">
                        <div class="gallery-grid">
                         @for (img of galleryImagePreviews; track $index) {
  <div class="gallery-item">
    <img [src]="img" alt="Galerie {{$index + 1}}">
    <button type="button"
            class="remove-btn"
            (click)="removeGalleryImage($index)"
            title="Supprimer">
      <i class="bi bi-x"></i>
    </button>
  </div>
}
                        </div>
                      </div>
                    }
                  </div>
                </div>
              </div>

              <!-- Section Formulaire (droite) -->
              <div class="col-lg-8">
                <div class="form-section">
                  <form [formGroup]="formationForm" (ngSubmit)="onSubmit()">

                    <!-- Informations essentielles -->
                    <div class="form-group-section">
                      <h4 class="group-title">
                        <i class="bi bi-info-circle"></i>
                        Informations essentielles
                      </h4>
                      <div class="form-grid">
                        <div class="form-field full-width">
                          <label for="nom" class="field-label">
                            Nom de la formation <span class="required">*</span>
                          </label>
                          <input type="text"
                                 id="nom"
                                 formControlName="nom"
                                 class="form-control modern-input"
                                 [class.is-invalid]="isFieldInvalid('nom')"
                                 placeholder="Ex: Développement Web Avancé">
                          <div class="invalid-feedback">
                            Le nom de la formation est obligatoire (min 3 caractères).
                          </div>
                        </div>
                        <div class="form-field full-width">
                          <label for="description" class="field-label">
                            Description <span class="required">*</span>
                          </label>
                          <textarea id="description"
                                   formControlName="description"
                                   class="form-control modern-textarea"
                                   [class.is-invalid]="isFieldInvalid('description')"
                                   rows="3"
                                   placeholder="Décrivez les objectifs et le contenu de votre formation..."></textarea>
                          <div class="invalid-feedback">
                            La description est obligatoire (min 10 caractères).
                          </div>
                        </div>
                        <div class="form-field">
                          <label for="duree" class="field-label">
                            Durée <span class="required">*</span>
                          </label>
                          <input type="text"
                                 id="duree"
                                 formControlName="duree"
                                 class="form-control modern-input"
                                 [class.is-invalid]="isFieldInvalid('duree')"
                                 placeholder="Ex: 3 mois">
                        </div>
                        <div class="form-field">
                          <label for="categorie" class="field-label">
                            Catégorie <span class="required">*</span>
                          </label>
                          <input type="text"
                                 id="categorie"
                                 formControlName="categorie"
                                 class="form-control modern-input"
                                 [class.is-invalid]="isFieldInvalid('categorie')"
                                 placeholder="Ex: Informatique">
                        </div>
                        <div class="form-field">
                          <label for="fraisInscription" class="field-label">
                            Frais d'inscription (FCFA) <span class="required">*</span>
                          </label>
                          <div class="input-group">
                            <input type="number"
                                   id="fraisInscription"
                                   formControlName="fraisInscription"
                                   class="form-control modern-input"
                                   [class.is-invalid]="isFieldInvalid('fraisInscription')"
                                   placeholder="50000">
                            <span class="input-group-text">FCFA</span>
                          </div>
                        </div>
                        <div class="form-field">
                          <label for="prix" class="field-label">
                            Prix (FCFA) <span class="required">*</span>
                          </label>
                          <div class="input-group">
                            <input type="number"
                                   id="prix"
                                   formControlName="prix"
                                   class="form-control modern-input"
                                   [class.is-invalid]="isFieldInvalid('prix')"
                                   placeholder="200000">
                            <span class="input-group-text">FCFA</span>
                          </div>
                        </div>
                      </div>
                    </div>

                    <!-- Options avancées -->
                    <div class="accordion-section">
                      <button type="button"
                              class="accordion-toggle"
                              [class.active]="activeSection === 'advanced'"
                              (click)="openSection('advanced')">
                        <i class="bi bi-gear-fill"></i>
                        <span>Options avancées</span>
                        <i class="bi bi-chevron-down toggle-icon"
                           [class.rotated]="activeSection === 'advanced'"></i>
                      </button>
                      <div class="accordion-content" [class.show]="activeSection === 'advanced'">
                        <div class="form-grid">
                          <div class="form-field full-width">
                            <div class="form-check-modern">
                              <input class="form-check-input"
                                     type="checkbox"
                                     id="certificatDelivre"
                                     formControlName="certificatDelivre">
                              <label class="form-check-label" for="certificatDelivre">
                                Certificat délivré
                              </label>
                            </div>
                          </div>
                          @if (formationForm.get('certificatDelivre')?.value) {
                            <div class="form-field full-width">
                              <label for="nomCertificat" class="field-label">Nom du Certificat</label>
                              <input type="text"
                                     id="nomCertificat"
                                     formControlName="nomCertificat"
                                     class="form-control modern-input"
                                     placeholder="Certificat de réussite en...">
                            </div>
                          }
                          <div class="form-field full-width">
                            <label for="programme" class="field-label">Programme</label>
                            <textarea id="programme"
                                     formControlName="programme"
                                     class="form-control modern-textarea"
                                     rows="2"
                                     placeholder="Détaillez le programme de formation..."></textarea>
                          </div>
                          <div class="form-field full-width">
                            <label for="objectifs" class="field-label">Objectifs</label>
                            <textarea id="objectifs"
                                     formControlName="objectifs"
                                     class="form-control modern-textarea"
                                     rows="2"
                                     placeholder="Quels sont les objectifs pédagogiques ?"></textarea>
                          </div>
                          <div class="form-field full-width">
                            <label for="materielFourni" class="field-label">Matériel fourni</label>
                            <textarea id="materielFourni"
                                     formControlName="materielFourni"
                                     class="form-control modern-textarea"
                                     rows="2"
                                     placeholder="Listez le matériel fourni aux apprenants..."></textarea>
                          </div>
                          <div class="form-field">
                            <label for="horaires" class="field-label">Horaires</label>
                            <input type="text"
                                   id="horaires"
                                   formControlName="horaires"
                                   class="form-control modern-input"
                                   placeholder="Ex: 9h-17h">
                          </div>
                          <div class="form-field">
                            <label for="frequence" class="field-label">Fréquence</label>
                            <input type="text"
                                   id="frequence"
                                   formControlName="frequence"
                                   class="form-control modern-input"
                                   placeholder="Ex: 3 fois par semaine">
                          </div>
                          <div class="form-field">
                            <label for="nombrePlaces" class="field-label">Nombre de places</label>
                            <input type="number"
                                   id="nombrePlaces"
                                   formControlName="nombrePlaces"
                                   class="form-control modern-input"
                                   [class.is-invalid]="isFieldInvalid('nombrePlaces')">
                          </div>
                          <div class="form-field">
                            <label for="nombreInscritsAffiche" class="field-label">Inscrits affichés</label>
                            <input type="number"
                                   id="nombreInscritsAffiche"
                                   formControlName="nombreInscritsAffiche"
                                   class="form-control modern-input"
                                   [class.is-invalid]="isFieldInvalid('nombreInscritsAffiche')">
                            <small class="form-text text-muted">Pour le social proof</small>
                          </div>
                          <div class="form-field full-width">
                            <div class="form-check-modern">
                              <input class="form-check-input"
                                     type="checkbox"
                                     id="socialProofActif"
                                     formControlName="socialProofActif">
                              <label class="form-check-label" for="socialProofActif">
                                Activer le Social Proof
                              </label>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <!-- Médias & Promotion -->
                    <div class="accordion-section">
                      <button type="button"
                              class="accordion-toggle"
                              [class.active]="activeSection === 'media'"
                              (click)="openSection('media')">
                        <i class="bi bi-megaphone-fill"></i>
                        <span>Médias & Promotion</span>
                        <i class="bi bi-chevron-down toggle-icon"
                           [class.rotated]="activeSection === 'media'"></i>
                      </button>
                      <div class="accordion-content" [class.show]="activeSection === 'media'">
                        <div class="form-grid">
                          <div class="form-field full-width">
                            <div class="form-check-modern">
                              <input class="form-check-input"
                                     type="checkbox"
                                     id="enPromotion"
                                     formControlName="enPromotion">
                              <label class="form-check-label" for="enPromotion">
                                Mettre la formation en promotion
                              </label>
                            </div>
                          </div>
                          @if (formationForm.get('enPromotion')?.value) {
                            <div class="promotion-fields">
                              <div class="form-field">
                                <label for="pourcentageReduction" class="field-label">Réduction (%)</label>
                                <input type="number"
                                       id="pourcentageReduction"
                                       formControlName="pourcentageReduction"
                                       class="form-control modern-input"
                                       [class.is-invalid]="isFieldInvalid('pourcentageReduction')"
                                       min="0" max="100">
                              </div>
                              <div class="form-field">
                                <label for="dateDebutPromo" class="field-label">Début promo</label>
                                <input type="datetime-local"
                                       id="dateDebutPromo"
                                       formControlName="dateDebutPromo"
                                       class="form-control modern-input">
                              </div>
                              <div class="form-field">
                                <label for="dateFinPromo" class="field-label">Fin promo</label>
                                <input type="datetime-local"
                                       id="dateFinPromo"
                                       formControlName="dateFinPromo"
                                       class="form-control modern-input">
                              </div>
                            </div>
                          }
                        </div>
                      </div>
                    </div>

                    <!-- SEO -->
                    <div class="accordion-section">
                      <button type="button"
                              class="accordion-toggle"
                              [class.active]="activeSection === 'seo'"
                              (click)="openSection('seo')">
                        <i class="bi bi-search"></i>
                        <span>Référencement (SEO)</span>
                        <i class="bi bi-chevron-down toggle-icon"
                           [class.rotated]="activeSection === 'seo'"></i>
                      </button>
                      <div class="accordion-content" [class.show]="activeSection === 'seo'">
                        <div class="form-grid">
                          <div class="form-field full-width">
                            <label for="metaTitle" class="field-label">Meta Title</label>
                            <input type="text"
                                   id="metaTitle"
                                   formControlName="metaTitle"
                                   class="form-control modern-input"
                                   placeholder="Titre pour les moteurs de recherche">
                          </div>
                          <div class="form-field full-width">
                            <label for="metaDescription" class="field-label">Meta Description</label>
                            <textarea id="metaDescription"
                                     formControlName="metaDescription"
                                     class="form-control modern-textarea"
                                     rows="2"
                                     placeholder="Description pour les résultats de recherche..."></textarea>
                          </div>
                        </div>
                      </div>
                    </div>

                    <!-- Bouton de soumission -->
                    <div class="submit-section">
                      <button type="submit"
                              class="btn-submit"
                              [disabled]="formationForm.invalid || isLoading"
                              [class.loading]="isLoading">
                        <div class="btn-content">
                          <span *ngIf="!isLoading" class="btn-text">
                            <i [ngClass]="isEditMode ? 'bi bi-pencil' : 'bi bi-plus-circle'"></i>
                            {{ isEditMode ? 'Enregistrer les modifications' : 'Créer la formation' }}
                          </span>
                          <span *ngIf="isLoading" class="btn-text loading">
                            <div class="spinner-sm"></div>
                            {{ isEditMode ? 'Modification en cours...' : 'Création en cours...' }}
                          </span>
                        </div>
                        <div class="btn-bg"></div>
                      </button>
                    </div>

                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
